SDG 15.3.1
==========

.. note:: 

SDG Indicator 15.3.1 measures the proportion of land that is degraded
over total land area. It is part of goal 15 that promotes “Life on Land”
and target 15.3 that states: ‘By 2030, combat desertification, restore
degraded land and soil, including land affected by desertification,
drought and floods, and strive to achieve a land degradation–neutral
world.’

This module allows to generate data for reporting on SDG indicators. The SEPAL SDG indicator module follows SDG `good practice guidance version 2 <https://www.unccd.int/sites/default/files/documents/2021-09/UNCCD_GPG_SDG-Indicator-15.3.1_version2_2021.pdf>`__, 

The methodology for SDG 15.3.1 module for GPG v1 (`good practice guidance from UNCCD on SDG 15.3.1 <https://prais.unccd.int/sites/default/files/helper_documents/4-GPG_15.3.1_EN.pdf>`__) was implemented in consultation with the `trends.earth <https://trends.earth/docs/en/index.html>`__ team and `Conservation International <https://www.conservation.org>`__.

Methodology
-----------

What is Land degradation
^^^^^^^^^^^^^^^^^^^^^^^^

The UNCCD defines land degradation as “\ *the reduction or loss of the
biological or economic productivity and complexity of rain fed cropland,
irrigated cropland, or range, pasture, forest and woodlands resulting
from a combination of pressures, including land use and management
practices”* (`UNCCD 1994, Article
1 <https://www.unccd.int/sites/default/files/relevant-links/2017-01/UNCCD_Convention_ENG_0.pdf>`__).
This definition was adopted for the SDG 15.3.1

UNCCD Good Practice Guidelines
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The first verison was issued in 2017. A revised version is issued in
2021. The module is based on the latest version of the ducument.

Approach
""""""""

Under the definition adopted by UNCCD, the extent of land degradation
for reporting on SDG Indicator 15.3.1 is calculated as a binary -
degraded/not degraded - quantification using its three sub-indicators:

-  Trends in land cover

-  Trends in land productivity, and

-  Trends in carbon stocks (above and below ground), currently
   represented by soil organic carbon (SOC) stocks

Essentially, any significant reduction or negative change in one of the
three sub-indicators is considered to comprise land degradation. That
means the results of the sub indicators are integrated using the one out
all out statistical princeple

Sub-indicators
##############

Productivity
++++++++++++

Land productivity cycles exhibit phases over time. a countinous decease
in productivity for a long time indicate potential degradation in land
productivity.

Threre matrices are used to detect such changes in productivity:

trend
     

It measures the trajectory of changes in productivity over long term.

The Mann–Kendall trend test is used to describe the monotonic trend or
trajectory (increasing or decreasing) of the productivity for a given
time period. The test statistics $S$ is defined as:

.. math:: S = \sum^{n-1}_{i=1}\sum^{n}_{j=i+1} sgn(x_j-x_i)

Where: X_i and X_j are the productivity of the sequence i and j years, n
is the length of the period and

.. math:: sgn(x_i -x_j) =  \left\{\begin{matrix} 1 & \text{if}\; x_j > x_i \\ 0 & \text{if}\; x_j = x_i \\ -1 & \text{if}\; x_j < x_i \\ \end{matrix}\right.

The variance of the S is determine using the following equation:

.. math:: VAR(S) = \frac{1}{18} [n(n-1)(2n + 5) – T]

Then the z score can be obtained using the following equation

.. math:: z \ \text{score}= \left\{\begin{matrix} \frac{S-1}{\sqrt{VAR(S)}} & \text{if} \; S > 0 \\ 0 & \text{if} \, S = 0 \\ \frac{S+1}{\sqrt{VAR(S)}} & \text{if} \; S < 0 \end{matrix}\right.

To identify the scale and dierction of the trend a five level scale is
proposed:

-  Z score < -1.96 = Degrading, as indicated by a significant decreasing
   trend

-  Z score < -1.28 AND ≥ -1.96 = Potentially Degrading

-  Z score ≥ -1.28 AND ≤ 1.28 = No significant change

-  Z score > 1.28 AND ≤ 1.96 = Potentially Improving, or

-  Z score > 1.96 = Improving, as indicated by a significant increasing
   trend

The area of the lowest negative z-score level (< -1.96) is considered as
degraded and areas in other z-score classes is as not degraded for
calculating the sub-indicator.

state
     

State represents the level of productivity in a land unit compared to
the historical observations of productivity for that land unit over
time. The mean and standard deviations are calculated as follows:

.. math::

   \mu = \frac{\sum_{n-15}^{n-3}x_n}{13} \\

   \sigma = \sqrt{\frac{\sum_{n-15}^{n-3}(x_n-\mu)^2}{13}}

Where x is the productivity and n is the year of analysis.

The mean productivity of the current period is given as:

.. math:: \bar{x} = \frac{\sum_{n-2}^nx_n}{3}

and the z score is given as

.. math:: z =\frac{\bar{x}-\mu}{\frac{\sigma}{\sqrt{3}}}

The five level stats are as follows:

-  Z score < -1.96 = Degraded, showing a significantly

   lower mean in the recent years compared to the longer term

-  Z score < -1.28 AND ≥ -1.96 = At risk of degrading

-  Z score ≥ -1.28 AND ≤ 1.28 = No significant change

-  Z score > 1.28 AND ≤ 1.96 = Potentially Improving

-  Z score > 1.96 = Improving, as indicated by a significantly higher
   mean in recent years compared to the longer term

The area of the lowest negative z-score level (< -1.96) is considered as
degraded and areas in other z-score classes is as not degraded for
calculating the sub-indicator.

performance
           

Productivity Performance indicates the level of local plant productivity
relative to other regions with similar productivity potential.

The maximum productivity index ($NPP_max$) value (90th percentile)
observed within the simillar ecoregion is campared the observed
productivty value (observed NPP). It is given as:

.. math:: \text{performance} = \frac{NPP_{observed}}{NPP_{max}}

The pixels with an NPP (vegetation index) less than 0.5 of the $NPP_max$
is considered as degraded.

to calculate the sub indicator following look table is used:

===== ===== =========== ========
trend State Performance Degraded
===== ===== =========== ========
Y     Y     Y           Y
Y     Y     N           Y
Y     N     Y           Y
Y     N     N           Y
N     Y     Y           Y
N     Y     N           N
N     N     Y           N
N     N     N           N
===== ===== =========== ========

Available Dataset: 
                  

Sensors : MODIS, Landsat 4, 5, 7 and 8, Sentinel 2

NPP metric: NDVI, EVI and MSVI

Land cover
++++++++++

Soil Organic Carbon
+++++++++++++++++++

Final indicator
+++++++++++++++

Users Guide
-----------

Select AOI
^^^^^^^^^^

The SDG 15.3.1 will be calculated based on the user inputs. The first mandatory input is the Area Of Interest (AOI). In this step you’ll have the possibility to choose from a predefined list of administrative layers or use your own datasets, the available options are:

**Predefined layers**

-   Country/province
-   Administrative level 1
-   Administrative level 2

**Custom layers**

-   Vector file
-   Drawn shapes on map
-   Google Earth Engine Asset

After selecting the desired area, click over :guilabel:`Select these inputs` and the map shows up your selection.

.. note::

    You can only select one area of interest. In some cases, depending on the input data you could run out of resources in GEE.
    
.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/aoi_selection.png
    :alt: AOI selection
    
Parameters
""""""""""

To run the computation of SDG 15.3.1, several parameters need to be set. Please read the `trends.earth documentation page <https://trends.earth/docs/en/background/understanding_indicators15.html>`__ to better understand what influence each one of them will have on the computation of the SDG 15.3.1 indicator and it's sub-indicators.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/parameters.png
    :alt: parameters

Mandatory parameters
####################

-   **Dates**: They are set in years and need to be in correct order. The **end date** that you select will change the list of available sensors. You won't be able to choose sensors that were not launch by the **end date**

-   **Sensors**: After selecting the dates, all the available sensors within the timeframe will be available. You can deselect or re-select any sensor you want. The default value is set to all the landsat satellites available within the selected timeframe.

    .. note:: 
   
        Some of the sensors are incompatible with each other. Thus selecting Landsat, MODIS or Sentinel dataset in the **sensors** dropdown will deselect the others. 
        
-   **Vegetation index**: THe vegetation index will be used to compute the trend trajectory, default to *NDVI*.

-   **trajectory**: There are 3 options available to calculate the productivity trend that describe trajectry of change. default to *productivity*.

-   **land ecosystem functional unit**: default to *Calculate based on land cover and soil texture* but you can also use *world ecosystem*.

-   **climate regime**: default to *Per pixel based on global climate data* but you can also use a fix value everywhere using a predefined climate regime in the dropdown menu or select a custom value on the slider

Advanced parameters
###################

To compute the land-cover subindicator the tool will use the CCI land cover system of the **start date** and the **end date**. these land cover Image will be reclassified in the UNCCD classification system and use to compute the land cover sub-indicator. Instead, users can specify custom values for the start and end land cover map using custom dataset. Provide the :code:`ee.Image` asset name and the band that need to be used and the CCI dataset will be replaced in the computation by your custom data. 

.. note::

    the custom dataset need to be classified in the UNCCD clasification system. PLease refer to :ref:`sdg_reclassiffy` to know how to reclassify your local dataset into this classification system.
    
To compute the land cover sub-indicator, the user can modify the transition matrix. Based on the user local knowledge of the conditions in the study area and the land degradation processed occurring there, use the table below to identify which transitions correspond to degradation (D), improvement (I), or no change in terms of land condition (S).

The lines stands for the baseline class and the columns for the target. 


.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/advanced_parameters.png
    :alt: advanced parameters
    
launch computation
##################

Once all the parameters are set you can run the analysis by clicking on :guilabel:`Load the indicators`.
It takes time to calulate all the sub-indicator. Look at the Alert at the bottom of the panel hat display the current state of analysis.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/validate_data.png
    :alt: validate data


Results
"""""""

The results are displayed to the end user in the next panel. On the left the user will find the transition and the distribution charts and on the right, an interactive map where every indicator and sub-indicators layers are displayed.

click on the :guilabel:`donwload` button to exort all the layers, charts and tables to your SEPAL folder. 

The results are gathered in the :code:`module_results/sdg_indicators/` folder. In this folder a folder is set for each AOI (e.g. :code:`SGP/` for Singapore) and within this folder results are grouped by run computation. the title of the folder reflect the parameters following this symbology: :code:`<start_year>_<end_year>_<satellites>_<vegetation index>_<lc units>_<custom LC>_<climate>`.

.. note:: 

    As an example for computation used in this documentation, the results were saved in : :code:`module_results/sdg_indicator/SGP/2015_2019_modis_ndvi_calculate_default_cr0/`

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/results.png
    :alt: validate data
    
.. note:: 

    the results are interactive, don't hesitate to interact with both the charts and the map layers using the widgets.
    
    .. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/results_interaction.gif
        :alt: result interaction
        
Transition graph 
^^^^^^^^^^^^^^^^

This chart is the `sankey's diagram <https://en.wikipedia.org/wiki/Sankey_diagram>`__ of the land cover transition between baseline and target year. The color is corresponding to the initial class.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/transition_graph.png
    :alt: transiton graph
    :width: 40%
    :align: center

Distribution graph 
^^^^^^^^^^^^^^^^^^

This chart displays the distribution of the SDG 15.3.1 indicator on each class of the UNCCD classification system.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/distribution_graph.png
    :alt: distribution chart
    :width: 40%
    :align: center

Interactive map
^^^^^^^^^^^^^^^

Are displayed on the map the following indicators: 

-   SDG 15.3.1
-   land cover sub-indicator
-   trajectory sub-indicator
-   performance sub-indicator

These indicator are all displayed using the same symbology (Improved: blue, stable: beige, degraded: red).

The tool also display the land cover maps from baseline and target years using the UNCCD symbology.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/lc_map.png
    :alt: lc_map
    :width: 80%
    :align: center


.. sdg_reclassify:

Reclassify
""""""""""

.. warning:: 

    To reclassify a land_cover map, this map need to be available to the user as a :code:`ee.Image` in GEE.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/reclassification.png
    :alt: reclassification


In order to use a custom land cover map, the user needs to first reclassify to the UNCCD classification system. This classification set values between 1 to 7 to describe the following land cover classes: 

#. forest
#. grassland
#. cropland
#. wetland
#. artificial
#. bareland
#. water

First select the asset in the combobox. It will be part of the dropdown value if the asset is part of the user's asset list. If that's not the case simply set the name of the asset in the TextField. 

Then select the band that will be reclassified.

.. note::

    This band need to be a categorical band, the reclassification sytem won't work with continuous values
    
Click on :guilabel:`get table`. This will generate a table with all the categorical values of the asset. In the second column the user can set the destination value. 

.. tip::

    - If the destination class is not set, the class will be interpreded as no_ata i.e. 0;
    - click on :guilabel:`save` to save the reclassification matrix. It's useful when the baseline and target map are in the same classification system;
    - click on :guilabel:`import` to import a previously saved reclassification matrix.
    
    
Click on :guilabel:`reclassify` to export the map in GEE using the UNCCD classification ystem. The export can be monitored in GEE. 

The following GIF will show you the full reclassification process with an simple example.

.. image:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/img/reclassify_demo.gif
    :alt: reclassification demo
.. custom-edit:: https://raw.githubusercontent.com/12rambau/sdg_indicators_module/master/doc/en.rst